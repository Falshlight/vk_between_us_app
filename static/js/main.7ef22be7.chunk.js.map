{"version":3,"sources":["App.js","index.js"],"names":["App","bridge","send","ReactDOM","render","document","getElementById"],"mappings":"wbAwQeA,G,OAnOH,WA0NX,OAAO,6FCrPRC,IAAOC,KAAK,gBAEZC,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,U","file":"static/js/main.7ef22be7.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\n//import bridge from '@vkontakte/vk-bridge';\n//import View from '@vkontakte/vkui/dist/components/View/View';\n//import ScreenSpinner from '@vkontakte/vkui/dist/components/ScreenSpinner/ScreenSpinner';\nimport '@vkontakte/vkui/dist/vkui.css';\n\n//import Home from './panels/Home';\n//import axios from 'axios';\n//import getFriends, {backend_url} from \"./panels/utils\";\n//import {platform, IOS, ANDROID, ModalCard, FormLayout, ModalRoot, ModalPage} from '@vkontakte/vkui';\n//import Icon24Done from '@vkontakte/icons/dist/24/done';\n//import PanelHeaderButton from \"@vkontakte/vkui/dist/components/PanelHeaderButton/PanelHeaderButton\";\n//import Icon24Cancel from '@vkontakte/icons/dist/24/cancel';\n//import ModalPageHeader from \"@vkontakte/vkui/dist/components/ModalPageHeader/ModalPageHeader\";\n//import Select from \"@vkontakte/vkui/dist/components/Select/Select\";\n//import RangeSlider from \"@vkontakte/vkui/dist/components/RangeSlider/RangeSlider\";\n//import Cell from \"@vkontakte/vkui/dist/components/Cell/Cell\";\n//import Switch from \"@vkontakte/vkui/dist/components/Switch/Switch\";\n//import Checkbox from \"@vkontakte/vkui/dist/components/Checkbox/Checkbox\";\n//\n//const osName = platform();\n//const IS_PLATFORM_IOS = osName === IOS;\n//const IS_PLATFORM_ANDROID = osName === ANDROID;\n\n/*\nfunction getParameterByName(name, url) {\n\tif (!url) url = window.location.href;\n\tname = name.replace(/[\\[\\]]/g, '\\\\$&');\n\tvar regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n\t\tresults = regex.exec(url);\n\tif (!results) return null;\n\tif (!results[2]) return '';\n\treturn decodeURIComponent(results[2].replace(/\\+/g, ' '));\n}*/\n\n//var _ = require('lodash');\n\nconst App = () => {\n\t//const [activePanel, setActivePanel] = useState('home');\n\t//const [fetchedUser, setUser] = useState(null);\n\t//const [accessToken, setAccessToken] = useState('');\n\t////const [popout, setPopout] = useState(<ScreenSpinner size='large' />);\n\t//const [friends, setFriends] = useState([]);\n\t//const [optionsList, setOptionsList] = useState([]);\n\t//const [updateFriends, setUpdateFriends] = useState(0);\n\t//const [filter, setFilter] = useState({'sex': 'a', 'age': {'from': 1, 'to': 100}, 'only_match': false});\n\t//const [hash, setHash] = useState('');\n\t//const [activeModal, setActiveModal] = useState(null);\n//\n\t//const [sex, setSex] = useState(filter['sex']);\n\t//const [ageFrom, setAgeFrom] = useState(filter['age']['from']);\n\t//const [ageTo, setAgeTo] = useState(filter['age']['to']);\n\t//const [onlyMatch, setOnlyMatch] = useState(filter['only_match']);\n\t//const [vkFriends, setVkFriends] = useState([]);\n\t//const [upd, setUpd] = useState(0);\n\t//const [currentUserIndex, setCurrentUserIndex] = useState(0);\n\n\t/*\n\tuseEffect(() => {\n\t\tbridge.subscribe(({ detail: { type, data }}) => {\n\t\t\tif (type === 'VKWebAppUpdateConfig') {\n\t\t\t\tconst schemeAttribute = document.createAttribute('scheme');\n\t\t\t\tschemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n\t\t\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t\t\t}\n\t\t});\n\n\t\tasync function fetchData() {\n\t\t\tconst user = await bridge.send('VKWebAppGetUserInfo');\n\t\t\tsetUser(user);\n\t\t\tvar att = await bridge.send(\"VKWebAppGetAuthToken\", {\"app_id\": 7602116, \"scope\": \"friends\"});\n\t\t\tsetAccessToken(att.access_token);\n\t\t\taxios.get(backend_url+'auth?at='+att.access_token+'&uid='+user.id).then((data) => {\n\t\t\t\tsetHash(data.data);\n\t\t\t});\n\t\t\tsetPopout(null);\n\n\t\t\tvar param = getParameterByName('vk_are_notifications_enabled', null);\n\t\t\tconsole.log('N:', param);\n\t\t\tif (!param || !parseInt(param)) bridge.send(\"VKWebAppAllowNotifications\").then((data) => {\n\t\t\t\tconsole.log(data);\n\t\t\t});\n\n\t\t}\n\t\t//fetchData();\n\t}, []);*/\n\t/*\n\tuseEffect(() => {\n\t\tsetSex(filter['sex']);\n\t\tsetAgeFrom(filter['age']['from']);\n\t\tsetAgeTo(filter['age']['to']);\n\t\tsetOnlyMatch(filter['only_match']);\n\t}, [filter]);\n\n\tuseEffect(() => {\n\t\tsetFilter({'sex': sex, 'age': {'from': ageFrom, 'to': ageTo}, 'only_match': onlyMatch});\n\t}, [sex, ageFrom, ageTo, onlyMatch]);\n\n\tuseEffect(() => {\n\t\taxios.get(backend_url+'get-options').then((data) => {\n\t\t\tsetOptionsList(data.data);\n\t\t});\n\t}, []);\n\n\tuseEffect( () => {\n\t\tif (accessToken.length) {\n\t\t\tgetFriends(accessToken).then((data) => {\n\t\t\t\tsetVkFriends(data.response.items);\n\n\t\t\t});\n\t\t}\n\n\t}, [accessToken]);\n\n\tuseEffect((fetchedUser, filter, friends, hash) => {\n\t\tif (fetchedUser) {\n\t\t\tconsole.log('upda');\n\t\t\taxios.post(backend_url+'get-friends?uid='+fetchedUser.id+'&hash='+hash, {'friends': vkFriends, 'uid': fetchedUser['id'], 'filter': filter},\n\t\t\t).then((data) => {\n\t\t\t\tconsole.log(data.data);\n\t\t\t\tif (!_.isEqual(data.data, friends)) setFriends(data.data);\n\t\t\t}).catch(() => {\n\t\t\t\tsetUpd(Math.random());\n\t\t\t});\n\t\t}\n\t}, [vkFriends, upd]);\n\n\tfunction timer() {\n\t\tsetUpd(Math.random());\n\t}\n\n\tuseEffect(() => {\n\t\tsetInterval(timer, 10000);\n\n\t\treturn function cleanup() {\n\t\t\tclearInterval(timer);\n\t\t};\n\t}, []);\n\n\tconst go = e => {\n\t\tsetActivePanel(e.currentTarget.dataset.to);\n\t};\n\n\tfunction openModalCard(e) {\n\t\tif (e) {\n\t\t\tvar ind = e.target.children[0].dataset.ind;\n\t\t\tvar uid = e.target.children[0].dataset.id;\n\t\t\tconsole.log(uid);\n\t\t\tfor (var i = 0; i < friends.length; i++) {\n\t\t\t\tif (friends[i].id === parseInt(uid)) break;\n\t\t\t}\n\t\t\tlet friend = friends[i];\n\t\t\tif (!friend) return;\n\t\t\tlet o = friend.options;\n\n\t\t\tsetCurrentUserIndex(uid);\n\t\t\tsetTimeout(() => {\n\t\t\t\tfor (var i = 0; i < o.length; i++) {\n\t\t\t\t\tvar oid = o[i]['index'];\n\t\t\t\t\tdocument.getElementById(\"checkbox-\"+(oid-1)).checked = true;\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t} else {\n\t\t\tsetCurrentUserIndex(null);\n\t\t}\n\t\tsetActiveModal(\"friend-options\");\n\t}\n\n\tfunction closeModal() {\n\t\tsetUpd(Math.random());\n\t\tsetActiveModal(null);\n\t}\n\n\tfunction closeModalCard() {\n\t\tsetActiveModal(null);\n\t}\n\n\tfunction applyModal() {\n\t\tvar checked_opts = [];\n\t\tfor (var i = 0; i < optionsList.length; i++) {\n\t\t\tvar el = document.getElementById(\"checkbox-\"+i);\n\t\t\tif (el.checked) {\n\t\t\t\tchecked_opts.push(i+1);\n\t\t\t}\n\t\t\tel.checked = false;\n\t\t}\n\n\t\tif (currentUserIndex != null) {\n\t\t\taxios.post(backend_url+'set-options?uid='+fetchedUser.id+'&hash='+hash, {'to': currentUserIndex, 'from': fetchedUser.id, 'options': checked_opts}).then(() => {\n\t\t\t\tsetUpd(Math.random());\n\t\t\t});\n\t\t} else {\n\t\t\tvar cells = [...document.getElementsByClassName(\"user-cell\")];\n\t\t\tvar users = cells.map((x) => parseInt(x.dataset.uid));\n\t\t\taxios.post(backend_url+'set-options?uid='+fetchedUser.id+'&hash='+hash, {'to': users, 'from': fetchedUser.id, 'options': checked_opts}).then(() => {\n\t\t\t\tsetUpd(Math.random());\n\t\t\t});\n\t\t}\n\t\tcloseModal();\n\n\t}\n\n\tconst modal = (<ModalRoot activeModal={activeModal} onClose={closeModal}>\n\t\t<ModalPage id=\"modal\" onClose={closeModal} header={<ModalPageHeader\n\t\t\tleft={IS_PLATFORM_ANDROID && <PanelHeaderButton onClick={closeModal}><Icon24Cancel /></PanelHeaderButton>}\n\t\t\tright={<PanelHeaderButton onClick={closeModal}>{IS_PLATFORM_IOS ? 'Готово' : <Icon24Done />}</PanelHeaderButton>}\n\t\t>\n\t\t\tФильтры\n\t\t</ModalPageHeader>}>\n\t\t\t<FormLayout>\n\t\t\t\t<Select top=\"Пол\" value={sex} onChange={(e) => {\n\t\t\t\t\tsetSex(e.target.value);\n\t\t\t\t}}>\n\t\t\t\t\t<option value=\"a\">Любой</option>\n\t\t\t\t\t<option value=\"m\">Мужской</option>\n\t\t\t\t\t<option value=\"f\">Женский</option>\n\t\t\t\t</Select>\n\t\t\t\t<RangeSlider\n\t\t\t\t\ttop=\"Возраст\"\n\t\t\t\t\tmin={1}\n\t\t\t\t\tmax={100}\n\t\t\t\t\tstep={1}\n\t\t\t\t\tdefaultValue={[ageFrom, ageTo]}\n\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\tsetAgeFrom(e[0]);\n\t\t\t\t\t\tsetAgeTo(e[1]);\n\t\t\t\t\t}}\n\t\t\t\t\tbottom={\"От \" + ageFrom + \" до \" + ageTo}\n\t\t\t\t/>\n\t\t\t\t<Cell asideContent={<Switch id=\"only-match\" checked={onlyMatch} onChange={(e) => {\n\t\t\t\t\tsetOnlyMatch(e.target.checked);\n\t\t\t\t}} />}>\n\t\t\t\t\tТолько совпадения\n\t\t\t\t</Cell>\n\t\t\t</FormLayout>\n\t\t</ModalPage>\n\n\t\t<ModalCard\n\t\t\tid=\"friend-options\"\n\t\t\tclassName=\"tst\"\n\t\t\theader=\"Выберите свойства\"\n\t\t\tonClose={closeModalCard}\n\t\t\tactions={[{title: 'Применить', mode: 'primary', action: applyModal}]}\n\t\t>\n\t\t\t<FormLayout>\n\t\t\t\t{(() => {\n\t\t\t\t\tlet a = [];\n\t\t\t\t\tfor (var i = 0; i < optionsList.length; i++) {\n\t\t\t\t\t\ta.push(<Checkbox id={'checkbox-'+i} key={'checkbox-'+i}>{optionsList[i]}</Checkbox>);\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t})()}\n\t\t\t</FormLayout>\n\t\t</ModalCard>\n\t</ModalRoot>);*/\n\treturn <h1>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</h1>;\n\t/*return (\n\t\t<View activePanel={activePanel}  modal={modal}>\n\t\t\t<Home id='home' fetchedUser={fetchedUser}\n\t\t\t\t    hash={hash}  optionsList={optionsList} setActiveModal={setActiveModal} friends={friends} setUpd={setUpd} openModalCard={openModalCard} setFilter={setFilter} filter={filter}  />\n\t\t\t</View>\n\t);*/\n};\n\nexport default App;\n\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport bridge from \"@vkontakte/vk-bridge\";\nimport App from \"./App\";\n\n\n\n// Init VK  Mini App\nbridge.send(\"VKWebAppInit\");\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}